/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.require("i2d.pp.mrpcockpit.reuse.view.S3parent");jQuery.sap.require("i2d.pp.mrpcockpit.reuse.controls.Stock");jQuery.sap.require("sap.ca.ui.model.type.Date");jQuery.sap.require("sap.ca.ui.model.type.DateTime");jQuery.sap.require("i2d.pp.prdorderissue.details.util.Formatters");jQuery.sap.require("i2d.pp.prdorderissue.details.controls.Milestone");jQuery.sap.require("i2d.pp.prdorderissue.details.controls.MilestoneChart");i2d.pp.mrpcockpit.reuse.view.S3parent.extend("i2d.pp.prdorderissue.details.view.S3",{onInit:function(){this.sdItemHighlightingNeeded=true;i2d.pp.mrpcockpit.reuse.view.S3parent.prototype.onInit.call(this);var c=new sap.ui.model.json.JSONModel({ComponentsCount:""});this.getView().setModel(c,"componentsModel")},onExit:function(){sap.ca.ui.utils.busydialog.releaseBusyDialog();i2d.pp.mrpcockpit.reuse.view.S3parent.prototype.onExit.call(this)},compareKeys:function(o,a){return(o.MRPElement===a.MRPElement&&o.MRPElementItem===a.MRPElementItem&&o.MRPElementCategory===a.MRPElementCategory)},getDetailListNavProperty:function(){return"ManufacturingOrder_To_SupplyDemandItems"},_onModelLoaded:function(e){var p=e.getParameter("url");if((p.indexOf(this.getDetailListNavProperty())<0)&&(p.indexOf("QuickViews")<0)&&(p.indexOf("ManufacturingOrderComponents")<0)){return}i2d.pp.mrpcockpit.reuse.view.S3parent.prototype._onModelLoaded.call(this,e);if(p.indexOf("ManufacturingOrderComponents")>0){this._updateComponentTabHeader(p);return}},onAfterRendering:function(){i2d.pp.mrpcockpit.reuse.view.S3parent.prototype.onAfterRendering.call(this)},_onRoutePatternMatched:function(e){var v=this.getView();if(e.getParameter("name")===i2d.pp.mrpcockpit.reuse.util.CommonConstants.ROUTING.DETAIL){var p=e.getParameter("arguments").contextPath;if(p.indexOf(i2d.pp.prdorderissue.details.util.Constants.MASTER_LIST_ENTITY)===0){i2d.pp.mrpcockpit.reuse.view.S3parent.prototype._onRoutePatternMatched.call(this,e)}else{jQuery.sap.log.debug("Ignoring the routing event for view "+v.getControllerName()+" because the path "+p+" doesn't contain the required master list entity "+i2d.pp.prdorderissue.details.util.Constants.MASTER_LIST_ENTITY);v.getModel().detachRequestCompleted(this._onModelLoaded,this)}}else{i2d.pp.mrpcockpit.reuse.view.S3parent.prototype._onRoutePatternMatched.call(this,e)}},selectIconTabBarSelect:function(e){if(e.getParameter("selectedKey")==="moComponentsTab"){this.byId("btnManageComponents").setVisible(true)}else{this.byId("btnManageComponents").setVisible(false)}},formatQuantity:function(q,d){return Math.abs(parseFloat(q)).toFixed(d)},visibilityMissingQuantity:function(m){return(m>0)},_updateComponentTabHeader:function(){var c=this.getView().getModel("componentsModel");if(c){var a=this.byId("allComponentsTable");var b=a.getBinding("items").iLength;c.setProperty("/ComponentsCount",b)}},formatComponentTabCount:function(m){if(!m||(m===0)){return""}return m},formatComponentTabIconColor:function(m){if(m&&(parseInt(m,10)>0)){return sap.ui.core.IconColor.Negative}return sap.ui.core.IconColor.Default},onComponentsUpdateFinished:function(){this._enableOrDisableManageButton()},onComponentsSelectionChange:function(){this._enableOrDisableManageButton()},_enableOrDisableManageButton:function(){var s=this.byId("allComponentsTable").getSelectedItems();var m=this.byId("btnManageComponents");if(!s||(s.length===0)){m.setEnabled(false)}else{m.setEnabled(true)}},formatDelay:function(d,D,m){if(parseFloat(m)===0){return this.oApplicationFacade.getResourceBundle().getText("COMPONENT_STATUS_AVAILABLE")}if(m!==D){return this.oApplicationFacade.getResourceBundle().getText("COMPONENT_STATUS_UNCOVERED")}if(d>1){return this.oApplicationFacade.getResourceBundle().getText("COMPONENT_STATUS_LATE_BY_DAYS",d)}if(d>0){return this.oApplicationFacade.getResourceBundle().getText("COMPONENT_STATUS_LATE_BY_ONE_DAY")}return""},formatDelayStatus:function(m){return m>0?sap.ui.core.ValueState.Error:sap.ui.core.ValueState.None},onManageComponents:function(){var f=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService;var c=f&&f("CrossApplicationNavigation");if(c){var m=this.byId("btnManageComponents");m.setEnabled(false);sap.ca.ui.utils.busydialog.requireBusyDialog();var h="MRPCockpitNavigation.332";var p=sap.ushell.Container.getService("Personalization");var C=h;if(p.getContainer){p.getContainer(C,{validity:i2d.pp.mrpcockpit.reuse.util.CommonConstants.VIEW_STATE_VALIDITY_TIME}).fail(function(){sap.ca.ui.utils.busydialog.releaseBusyDialog();jQuery.sap.log.error("Loading personalization data failed.")}).done(function(o){o.setItemValue("Navigation",this.getNavigationParams());o.save().done(function(){sap.ca.ui.utils.busydialog.releaseBusyDialog();c.toExternal({target:this.getNavigationTarget(),params:{"navigationID":h}})}.bind(this))}.bind(this))}}},getNavigationParams:function(){var s=this.byId("allComponentsTable").getSelectedItems();var m=this.byId("componentsObjectHeader").getBindingContext().getProperty("ComponentShortageDefinitionID");var d=this.getDemandType();var M=[];var a=[];var b=[];var c=[];var e=[];var f=[];var g=[];var h=[];var i;for(i=0;i<s.length;i++){var B=s[i].getBindingContext();var j=B.getProperty("MaterialID");M.push(j);var k=B.getProperty("MRPArea");a.push(k);var l=B.getProperty("MRPPlant");b.push(l);var n=B.getProperty("MRPElement");c.push(n);var o=B.getProperty("MRPElementItem");e.push(o);var p="";f.push(p);var q=B.getProperty("MRPElementCategory");g.push(q);var r=B.getProperty("MRPElementAvailyOrRqmtDate");h.push(r)}var P={"MaterialShortageDefinitionID":m,"DemandType":d,"MaterialID":M,"MRPArea":a,"MRPPlant":b,"MRPElement":c,"MRPElementItem":e,"MRPElementScheduleLine":f,"MRPElementCategory":g,"MRPElementAvailyOrRqmtDate":h};return P},getDemandType:function(){return"8"},getNavigationTarget:function(){return{semanticObject:"MRPProductionRequirement",action:"manage"}},formatOpsTabIconColor:function(d){return(d&&(d>0))?sap.ui.core.IconColor.Negative:sap.ui.core.IconColor.Default},formatOpsColumnHeader:function(c,C,o){if(c==="BR"){return o}return C}});
